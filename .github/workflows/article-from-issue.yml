name: æŠ•ç¨¿Issueã‹ã‚‰è¨˜äº‹ã‚’ç”Ÿæˆ

on:
  issues:
    types: [opened]

jobs:
  generate-article:
    if: startsWith(github.event.issue.title, '[è¨˜äº‹]')
    runs-on: ubuntu-latest
    steps:
      - name: ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v3

      - name: Issueå†…å®¹ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
        id: generate
        run: |
          ISSUE_NUMBER=${{ github.event.issue.number }}
          TITLE=$(echo "${{ github.event.issue.title }}" | sed 's/^\[è¨˜äº‹\] //')
          AUTHOR=$(echo "${{ github.event.issue.body }}" | grep -i "^ğŸ–‹ è‘—è€…å" | sed 's/^.*:\s*//')
          TAGS=$(echo "${{ github.event.issue.body }}" | grep -i "^ğŸ· ã‚¿ã‚°" | sed 's/^.*:\s*//' | sed 's/, */, /g')
          DATE=$(date "+%Y-%m-%d")
          FILENAME="docs/contents/${DATE}-${ISSUE_NUMBER}.md"

          echo "ä½œæˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«: $FILENAME"
          echo "title: $TITLE"
          echo "author: $AUTHOR"
          echo "tags: [$TAGS]"

          cat <<EOF > $FILENAME
---
title: "$TITLE"
author: "$AUTHOR"
date: "$DATE"
tags: [${TAGS}]
---

${{ github.event.issue.body }}
EOF

          echo "filename=$FILENAME" >> $GITHUB_OUTPUT

      - name: Gitãƒ–ãƒ©ãƒ³ãƒä½œæˆãƒ»ã‚³ãƒŸãƒƒãƒˆãƒ»PRä½œæˆ
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: "æŠ•ç¨¿è¨˜äº‹: ${{ github.event.issue.title }}"
          branch: "post/${{ github.event.issue.number }}"
          base: dev
          title: "${{ github.event.issue.title }}"
          body: "ã“ã®PRã¯ Issue #${{ github.event.issue.number }} ã‹ã‚‰è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚"
